{% extends 'base_open.html' %}

{% load static %}

{% load shortener_filters %}

{% load crispy_forms_tags %}

{% block content %}

<!-- Begin page content -->
<main class="flex-shrink-0">
  <div class="container" align="center">
    <p>&nbsp;</p>

    <div class="row">
      <div class="col-sm-3">&nbsp;</div>
        <div class="col-md-6">
          <form method="GET" action="">
            {{ form|crispy }}
            <div class="input-group mb-3">
              <input id="search" type="text" name="q" class="form-control" value="{{ request.GET.q }}" placeholder="Search by Title or Topic" aria-label="Search by Title or Topic" aria-describedby="button-addon2">
              <button class="btn btn-outline-primary" type="submit" id="button-addon2">Search</button>
            </div>
          </form>
        </div>
      <div class="col-sm-3">&nbsp;</div>
    </div><br />

    <div class="row">
      <div class="col-lg-12">

        <div class="table-responsive">

          {% if is_paginated %}
            {% include 'pagination.html' %}
          {% endif %}

          <div align="left"><strong>Links: {{ total_results }}</strong></div>

          <table class="table table-striped table-hover table-md">

            <thead>
              <tr class="table-primary">
                <th>&nbsp;</th>
                <th>Recent Links</th>
              </tr>
            </thead>

            <tbody>  

              {% for link in links %}

              <tr>
                <td align="center">
                  {{ link.created_at|date:"M j" }}<br />
                  <a class="btn btn-sm btn-outline-primary rounded-pill px-2" href="{% url 'redirect-url' link.short_alias %}" target="_blank" role="button">{{ link.short_alias }}</a><br />

                  <button style="margin-top: 5px;" class="btn btn-sm btn-outline-success rounded-pill px-2 copy-btn">Copy</button><br /><span class="copy-message text-success" style="display: none; font-size: 0.8em; margin-left: 5px;"></span>
                  <div class="copy-data" data-alias="https://psinergy.link/{{ link.short_alias }}/" data-title="{% if link.title %}{{ link.title }}{% else %}Title not available{% endif %}" data-tags="{{ link.tags|links_copy }}"></div>
                </td>

                <td align="left">
                  <div>
                    {% if link.title == "" or link.title == None %}
                      <strong>Title not available</strong>
                    {% else %}
                      <a href="{% url 'redirect-url' link.short_alias %}" target="_blank"><strong>{{ link.title }}</strong></a>
                    {% endif %}</a><br />
                  </div>

                  <div>{{ link.long_url|long_url_website }}</div>

                  <div>{% for tag in link.tags.all %}{% if tag.slug %}<a href="{% url 'shortener-list-by-tag-open' tag.slug %}"><span class="badge text-bg-success" style="margin-top: 1px; margin-right: 1px;">{{ tag.name }}</span></a> {% endif %}{% endfor %}</div>
                </td>
              </tr>

              {% endfor %}

            </tbody>
          </table>

          {% if is_paginated %}
            {% include 'pagination.html' %}
          {% endif %}

        </div>
      </div>

    <!-- row end -->
    </div>

    <script src="{% static 'js/copy-button.js' %}"></script>

  <!-- container end -->
  </div>

</main>

{% endblock %}
